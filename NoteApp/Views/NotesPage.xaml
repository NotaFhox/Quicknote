<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="NoteApp.Views.NotesPage"
             x:DataType="viewModels:NotesViewModel"
             xmlns:viewModels="clr-namespace:NoteApp.ViewModels"
             xmlns:models="clr-namespace:NoteApp.Models"
             Title="{Binding Title}"
             BackgroundColor="{StaticResource WindowsBeige}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        
        <Frame Grid.Row="0" 
               BackgroundColor="{StaticResource ButtonFace}" 
               BorderColor="{StaticResource ControlDark}"
               CornerRadius="0"
               HasShadow="False"
               Padding="12">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
               
                <Label Grid.Row="0" Grid.ColumnSpan="2"
                       Text="My Notes"
                       Style="{StaticResource SubHeadline}"
                       HorizontalTextAlignment="Start"
                       Margin="0,0,0,8" />
                
                
                <Frame Grid.Row="1" Grid.Column="0"
                       Style="{StaticResource ContentFrame}"
                       Margin="0,0,8,4">
                    <SearchBar Placeholder="Search notes..."
                               Text="{Binding SearchText}"
                               SearchCommand="{Binding SearchCommand}"
                               BackgroundColor="Transparent" />
                </Frame>
                
                <Button Grid.Row="1" Grid.Column="1"
                        Text="Clear"
                        Command="{Binding ClearSearchCommand}"
                        IsVisible="{Binding SearchText, Converter={StaticResource StringIsNotNullOrEmptyConverter}}"
                        WidthRequest="60"
                        VerticalOptions="Fill" />
                
                
                <Frame Grid.Row="2" Grid.ColumnSpan="2"
                       Style="{StaticResource ContentFrame}"
                       Margin="0,4,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        
                        <Label Grid.Column="0" 
                               Text="Category:" 
                               VerticalOptions="Center"
                               Margin="0,0,8,0"
                               FontAttributes="Bold" />
                        
                        <Picker Grid.Column="1"
                                Title="All Categories"
                                ItemsSource="{Binding Categories}"
                                SelectedItem="{Binding SelectedCategory}"
                                BackgroundColor="Transparent" />
                    </Grid>
                </Frame>
            </Grid>
        </Frame>

         
        <ScrollView Grid.Row="1" 
                    BackgroundColor="{StaticResource White}"
                    Margin="8">
            <StackLayout Spacing="8" Padding="8">
                <CollectionView ItemsSource="{Binding Notes}"
                                SelectionMode="None"
                                BackgroundColor="Transparent">
                    <CollectionView.EmptyView>
                        <Frame Style="{StaticResource ContentFrame}"
                               Margin="20"
                               Padding="40">
                            <StackLayout VerticalOptions="Center" 
                                       HorizontalOptions="Center" 
                                       Spacing="16">
                                <Label Text="ðŸ“" 
                                       FontSize="48" 
                                       HorizontalTextAlignment="Center" />
                                <Label Text="No notes found" 
                                       FontSize="18" 
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource Gray600}"
                                       HorizontalTextAlignment="Center" />
                                <Label Text="Click the 'Add Note' button below to create your first note" 
                                       TextColor="{StaticResource Gray600}" 
                                       HorizontalTextAlignment="Center" />
                            </StackLayout>
                        </Frame>
                    </CollectionView.EmptyView>
                    
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:Note">
                            <Frame Style="{StaticResource ContentFrame}" 
                                   Margin="0,0,0,4"
                                   Padding="12">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                     
                                    <Label Grid.Row="0" Grid.Column="0"
                                           Text="{Binding Title}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource Black}"
                                           Margin="0,0,0,4" />
                                    
                                     
                                    <Label Grid.Row="1" Grid.Column="0"
                                           Text="{Binding Content}"
                                           MaxLines="2"
                                           LineBreakMode="TailTruncation"
                                           TextColor="{StaticResource Gray700}"
                                           FontSize="14"
                                           Margin="0,0,0,8" />
                                    
                                     
                                    <Frame Grid.Row="2" Grid.Column="0"
                                           BackgroundColor="{StaticResource Secondary}"
                                           BorderColor="{StaticResource Primary}"
                                           CornerRadius="0"
                                           Padding="6,2"
                                           Margin="0,0,0,4"
                                           HorizontalOptions="Start"
                                           HasShadow="False">
                                        <Label Text="{Binding Category}"
                                               Style="{StaticResource CategoryLabel}"
                                               BackgroundColor="Transparent"
                                               Padding="0" />
                                    </Frame>
                                    
                                    
                                    <Label Grid.Row="3" Grid.Column="0"
                                           Text="{Binding DateModified, StringFormat='Modified: {0:dd MMM yyyy HH:mm}'}"
                                           Style="{StaticResource MetadataLabel}" />

                                     
                                    <StackLayout Grid.Row="0" Grid.Column="1" Grid.RowSpan="4"
                                               Orientation="Vertical"
                                               Spacing="4"
                                               VerticalOptions="Center">
                                        
                                        <Button Text="Edit"
                                                FontSize="12"
                                                WidthRequest="50"
                                                HeightRequest="24"
                                                Padding="4,2"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:NotesViewModel}}, Path=SelectNoteCommand}"
                                                CommandParameter="{Binding .}" />
                                        
                                        <Button Text="Delete"
                                                FontSize="12"
                                                WidthRequest="50"
                                                HeightRequest="24"
                                                Padding="4,2"
                                                BackgroundColor="{StaticResource ClassicRed}"
                                                TextColor="{StaticResource White}"
                                                BorderColor="{StaticResource ControlDark}"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:NotesViewModel}}, Path=DeleteNoteCommand}"
                                                CommandParameter="{Binding .}" />
                                    </StackLayout>

                                     
                                    <Grid.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:NotesViewModel}}, Path=SelectNoteCommand}"
                                                              CommandParameter="{Binding .}" />
                                    </Grid.GestureRecognizers>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </StackLayout>
        </ScrollView>

         
        <Frame Grid.Row="2"
               BackgroundColor="{StaticResource ButtonFace}"
               BorderColor="{StaticResource ControlDark}"
               CornerRadius="0"
               HasShadow="False"
               Padding="12,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                 
                <Label Grid.Column="0"
                       Text="{Binding Notes.Count, StringFormat='{0} notes'}"
                       VerticalOptions="Center"
                       TextColor="{StaticResource Gray600}"
                       FontSize="12" />
                
                 
                <Button Grid.Column="1"
                        Text="Add Note"
                        Style="{StaticResource AccentButton}"
                        FontSize="14"
                        WidthRequest="100"
                        HeightRequest="32"
                        Command="{Binding AddNoteCommand}" />
            </Grid>
        </Frame>

         
        <Frame Grid.Row="1"
               IsVisible="{Binding IsBusy}"
               BackgroundColor="{StaticResource ButtonFace}"
               BorderColor="{StaticResource ControlDark}"
               CornerRadius="0"
               VerticalOptions="Center"
               HorizontalOptions="Center"
               Padding="20">
            <StackLayout Orientation="Horizontal" Spacing="12">
                <ActivityIndicator IsRunning="{Binding IsBusy}"
                                 VerticalOptions="Center" />
                <Label Text="Loading notes..."
                       VerticalOptions="Center"
                       TextColor="{StaticResource Black}" />
            </StackLayout>
        </Frame>
    </Grid>
</ContentPage>